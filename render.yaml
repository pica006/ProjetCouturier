# ============================================================================
# Déploiement Render - An's Learning / Gestion Couturier
# ============================================================================
# Documentation : voir DEPLOY_RENDER.md
# ============================================================================

services:
  - type: web
    name: couturier-app
    env: python
    region: frankfurt

    # Build
    buildCommand: pip install -r requirements.txt

    # Health check : Streamlit expose /_stcore/health (évite l'écran blanc)
    healthCheckPath: /_stcore/health

    # Commande de démarrage Streamlit (PORT fourni par Render)
    startCommand: streamlit run app.py --server.port=$PORT --server.address=0.0.0.0 --server.headless=true --server.enableCORS=false --server.enableXsrfProtection=true

    # Variables d'environnement - DATABASE_URL uniquement (connexion Render-safe)
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: db-couturier
          property: connectionString

    # Plan : starter (payant) ou retirer pour utiliser le plan gratuit
    # plan: starter

databases:
  - name: db-couturier
    databaseName: db_couturier
    user: couturier_user
    # plan: starter  # Optionnel : plan payant pour DB persistante

